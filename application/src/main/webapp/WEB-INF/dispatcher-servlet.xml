<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd">

    <bean id="placeholderConfigurer"
          class="org.springframework.web.context.support.ServletContextPropertyPlaceholderConfigurer">
        <property name="contextOverride" value="true"/>
        <property name="searchContextAttributes" value="true"/>
        <property name="location" value="classpath:default.properties"/>
    </bean>

    <context:component-scan base-package="se.codemate.spring.controllers"/>
    <context:component-scan base-package="com.fairviewiq.spring.controllers"/>

    <bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
        <property name="defaultEncoding" value="UTF-8"/>
        <property name="cacheSeconds" value="1"/>
        <property name="basenames">
            <list>
                <value>WEB-INF/i18n/messages</value>
            </list>
        </property>
    </bean>

    <bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver">
        <property name="defaultLocale" value="sv"/>
    </bean>

    <bean id="themeResolver" class="org.springframework.web.servlet.theme.SessionThemeResolver">
        <property name="defaultThemeName" value="default"/>
    </bean>

    <bean id="neoTransactionInterceptor" class="se.codemate.spring.mvc.NeoTransactionInterceptor"/>

    <bean id="fairviewUserResolver" class="com.fairviewiq.spring.web.interceptor.FairviewUserResolver"/>

    <bean id="localeChangeInterceptor" class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"/>

    <bean id="themeChangeInterceptor" class="org.springframework.web.servlet.theme.ThemeChangeInterceptor"/>

    <bean id="jasperReportController" class="com.fairviewiq.spring.controllers.FairviewReportController">
        <property name="reportRoot" value="${report.root}"/>
        <property name="imageServletPath" value="/report-images"/>
        <property name="indexViewName" value="/reports/index"/>
    </bean>

    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <property name="maxUploadSize" value="10000000"/>
    </bean>

    <bean id="handlerMapping" class="se.codemate.spring.mvc.AnnotationAndUrlHandlerMapping">
        <property name="alwaysUseFullPath" value="true"/>
        <property name="defaultHandler">
            <bean id="defaultController" class="se.codemate.spring.controllers.DefaultController"/>
        </property>
        <property name="mappings">
            <props>
                <prop key="/reports/*">jasperReportController</prop>
            </props>
        </property>
        <property name="interceptors">
            <list>
                <ref local="themeChangeInterceptor"/>
                <ref local="localeChangeInterceptor"/>
                <ref local="neoTransactionInterceptor"/>
                <ref local="fairviewUserResolver"/>
            </list>
        </property>
    </bean>

    <bean id="emailNotificationService" class="se.codemate.spring.mvc.EmailNotificationService">
        <property name="exceptionMailSender" ref="mailSender"/>
        <property name="templateExceptionMailMessage">
            <bean class="org.springframework.mail.SimpleMailMessage">
                <property name="to" value="${smtp.to}"/>
                <property name="from" value="${smtp.from}"/>
                <property name="subject" value="Fairview app has had a fatal exception occur"/>
            </bean>
        </property>
    </bean>

    <bean id="exceptionResolver" class="se.codemate.spring.mvc.NotifyingExceptionResolver">
        <property name="defaultStatusCode" value="500"/>
        <property name="defaultErrorView" value="errors/general-error"/>
        <property name="exceptionMappings">
            <props>
                <prop key="se.codemate.spring.aspects.NeoAjaxException">errors/ajax-error</prop>
            </props>
        </property>
        <property name="statusCodeMappings">
            <map>
                <entry key="errors/ajax-error" value="200"/>
            </map>
        </property>
        <property name="priorityExceptionMappings">
            <props>
                <prop key="org.neo4j.graphdb.NotFoundException">high</prop>
            </props>
        </property>
        <property name="priorityNotificationServicesMappings">
            <map>
                <entry key="high" value-ref="emailNotificationService"/>
            </map>
        </property>
    </bean>

</beans>